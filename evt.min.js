(function(f){function h(a){for(var b=e.prototype.instances,d=b.length,c=0;c<d;c++)b[c].el===this&&b[c].handle(a)}function k(a){a=(a||"").split(".");var b=a.shift();a=a.sort();var d=new RegExp(a.join(".*?\\."));return{type:!!b&&b,namespace:!!a.length&&a.join("."),regex:!!a.length&&d}}var g=f.document.documentElement.matches,n=f.Event.prototype.stopPropagation,p=f.Event.prototype.stopImmediatePropagation;if(!g)for(var m=["ms","moz","webkit"],l=m.pop();l;){g=l+"MatchesSelector";if(g in f.document.documentElement){g= f.document.documentElement[g];break}l=m.pop()}var e=function(a){if(!(this instanceof e))return new e(a);a=a instanceof Node?a:f.document.querySelector(a);for(var b=this.instances,d=b.length,c=0;c<d;c++)if(b[c].el===a)return b[c];this.el=a;this.events={};this.handlers=[];this.instances.push(this)};e.prototype.instances=[];e.prototype.matches=function(a,b){return b?g.call(a,b):this.el===a};e.prototype.on=function(a,b,d){if("function"===typeof b)return this.on(a,void 0,b);a=k(a);var c=a.type;a=a.namespace|| "";this.events[c]||(this.events[c]=0,this.el.addEventListener(c,h));this.events[c]++;this.handlers.push({event:c,namespace:a,selector:b,callback:d});return this};e.prototype.off=function(a,b,d){if("function"===typeof b)return this.off(a,void 0,b);a=k(a);if(!(a.type||a.namespace||b||d)){for(a in this.events)this.events.hasOwnProperty(a)&&this.el.removeEventListener(a,h);this.events={};this.handlers=[];return this}for(var c,e=this.handlers.length;e--;)if(c=this.handlers[e],!a.type||a.type===c.event)if(!a.namespace|| a.regex.test(c.namespace))b&&b!==c.selector||d&&d!==c.callback||(this.events[c.event]--,0===this.events[c.event]&&this.el.removeEventListener(c.event,h),this.handlers.splice(e,1));return this};e.prototype.handle=function(a){function b(b){if(d===b.event&&this.matches(f,b.selector)&&(!c||!b.namespace||e.test(b.namespace)))return b.callback.call(f,a),k}var d=a.type,c=a.namespace&&a.namespace.split("."),e,f=a.target,g=this.handlers,h=!1,k=!1;c&&(e=new RegExp(c.join(".*?\\.")));a.stopPropagation=function(){h= !0;n.call(this)};for(a.stopImmediatePropagation=function(){k=h=!0;p.call(this)};f!==this.el.parentNode;){g.some(b,this);if(h)break;f=f.parentNode}};e.prototype.trigger=function(a,b){var d;b=b||this.el;a=k(a);d=f.document.createEvent("Events");d.initEvent(a.type,!0,!0);a.namespace&&(d.namespace=a.namespace);b.dispatchEvent(d);return this};f.Evt=e})(window);