(function(f){function l(a){c.prototype.instances[this].handle(a)}function g(a){a=(a||"").split(".");var b=a.shift();a=a.sort();var h=new RegExp(a.join(".*?\\."));return{type:!!b&&b,namespace:!!a.length&&a.join("."),regex:!!a.length&&h}}var e=f.document.documentElement.matches,n=f.Event.prototype.stopPropagation,p=f.Event.prototype.stopImmediatePropagation;if(!e)for(var m=["ms","moz","webkit"],k=m.pop();k;){e=k+"MatchesSelector";if(e in f.document.documentElement){e=f.document.documentElement[e];break}k= m.pop()}var c=function(a){if(!(this instanceof c))return new c(a);a=a instanceof Node?a:f.document.querySelector(a);if(this.instances[a])return this.instances[a];this.el=a;this.events={};this.handlers=[];this.instances[a]=this};c.prototype.instances={};c.prototype.matches=function(a,b){return b?e.call(a,b):this.el===a};c.prototype.on=function(a,b,h){if("function"===typeof b)return this.on(a,void 0,b);a=g(a);var d=a.type;a=a.namespace||"";this.events[d]||(this.events[d]=0,this.el.addEventListener(d, l));this.events[d]++;this.handlers.push({event:d,namespace:a,selector:b,callback:h});return this};c.prototype.off=function(a,b,h){if("function"===typeof b)return this.off(a,void 0,b);a=g(a);if(!(a.type||a.namespace||b||h)){for(a in this.events)this.events.hasOwnProperty(a)&&this.el.removeEventListener(a,l);this.events={};this.handlers=[];return this}for(var d,c=this.handlers.length;c--;)if(d=this.handlers[c],!a.type||a.type===d.event)if(!a.namespace||a.regex.test(d.namespace))b&&b!==d.selector||h&&h!==d.callback||(this.events[d.event]--,0===this.events[d.event]&&this.el.removeEventListener(d.event,l),this.handlers.splice(c,1));return this};c.prototype.handle=function(a){function b(b){if(c===b.event&&this.matches(e,b.selector)&&(!d||!b.namespace||f.test(b.namespace)))return b.callback.call(e,a),k}var c=a.type,d=a.namespace&&a.namespace.split("."),f,e=a.target,l=this.handlers,g=!1,k=!1;d&&(f=new RegExp(d.join(".*?\\.")));a.stopPropagation=function(){g=!0;n.call(this)};for(a.stopImmediatePropagation=function(){k=g=!0;p.call(this)};e!==this.el.parentNode;){l.some(b,this);if(g)break;e=e.parentNode}};c.prototype.trigger=function(a,b){var c;b=b||this.el;a=g(a);c=f.document.createEvent("Events");c.initEvent(a.type,!0,!0);a.namespace&&(c.namespace=a.namespace);b.dispatchEvent(c);return this};f.Evt=c})(window);